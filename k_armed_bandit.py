import random
from matplotlib import pyplot as plt
import numpy as np
random.seed(3)

# k-armed bandit

k = 10
iterations = 100
tests = 1000 # run 1000 times the algorithm and look at the avg reward
epsilon = .1

mean_range = [-2, 2]
sigma_range = [1, 1]

def parameters_of_distributions(k): # k gaussians with random mean and unit variance
    return [[random.randint(mean_range[0], mean_range[1]), random.randint(sigma_range[0], sigma_range[1])] for _ in range(k)]

distributions = parameters_of_distributions(k)
print(distributions)

def bandit(a): # sample from the a-th probability distribution and return the value
    return random.gauss(distributions[a][0], distributions[a][1])

average_rewards = [0 for _ in range(iterations)]

for test in range(tests):
    # initialize
    Q = [0 for _ in range(k)]
    N = [0 for _ in range(k)]
    
    # big loop
    for _ in range(iterations):
        # action choice
        if random.random() <= epsilon:
            a = random.choice(range(k))
        else:
            a = np.argmax(Q)
        # update
        r = bandit(a)
        N[a] += 1
        Q[a] += (r-Q[a])/N[a]

        average_rewards[_] += r
        
average_rewards = [average_rewards[_]/tests for _ in range(iterations)]
plt.figure()
plt.plot(range(iterations), average_rewards)
plt.show()

'''
plt.figure()
plt.plot(range(iterations), [-0.9917604105212529, -0.12847987207450393, 0.7854800621161127, 1.0952049923658627, 1.2840674275992854, 1.429628170354502, 1.407908265494903, 1.4545540563144472, 1.599026219336869, 1.5694543556136744, 1.5809116298847437, 1.6327754717708967, 1.5940715555508669, 1.6579621806554303, 1.666327210468078, 1.702078959319879, 1.6970560482179928, 1.6972052472824606, 1.6987562450863698, 1.742372202684181, 1.77924272225214, 1.6748646511912135, 1.740079175784532, 1.7155898514000374, 1.7922332939543058, 1.7511850630558063, 1.7404369490105278, 1.7412100963439787, 1.7454283493439935, 1.7644048121539782, 1.7884311814388987, 1.774450634446897, 1.7898539514629987, 1.8344296231422792, 1.7675052406674399, 1.7891108141168002, 1.7898124756102718, 1.814575993440995, 1.7591875380360107, 1.8086023099135098, 1.791369004250565, 1.8602226004292945, 1.7963997213918215, 1.8194897645031918, 1.8264150802821113, 1.8019528865960315, 1.8844583404612134, 1.860428594422172, 1.8054698655126578, 1.8300901129115368, 1.8182064109122202, 1.834959435534147, 1.854218085605252, 1.8451445012835077, 1.8323870488430658, 1.9097889315302723, 1.8103642195000134, 1.8937024473636963, 1.8425627271861245, 1.8324658160602758, 1.8690585234685568, 1.8134663486996139, 1.850514179892891, 1.8559645921859391, 1.9177497346688612, 1.8572170554945737, 1.8963407991545063, 1.8422665908570013, 1.816211363800844, 1.8469780821853317, 1.894820985779727, 1.8762500496725492, 1.903868671088438, 1.8384140502991482, 1.847155299712438, 1.9194283500966018, 1.8895566533125827, 1.9407308693466838, 1.9009585479246303, 1.863393432599315, 1.8873265092149243, 1.8963805327951162, 1.8448115209517908, 1.874864417480303, 1.8704644032415254, 1.8602079384984234, 1.913450867812493, 1.8946396431431476, 1.910451815977134, 1.8873449231942672, 1.919477866858284, 1.846681016218259, 1.8412447175709425, 1.9064814860398176, 1.8884695180157711, 1.9002007819669302, 1.853679937755525, 1.900544994991068, 1.9065479551375824, 1.872841033227486])
plt.plot(range(iterations), [-0.9772886798866912, -0.14840649179363516, 0.7582413720391115, 1.1896616645304, 1.3076376884217988, 1.4125331638710787, 1.4738156869640509, 1.427583960739991, 1.5134878280561213, 1.5886697858460466, 1.5514394763450612, 1.5807842862114434, 1.6370210073280496, 1.6670167707303716, 1.5726610243667734, 1.6630633976139517, 1.7147493004582737, 1.6801259307537428, 1.6986322182703248, 1.6195041126235334, 1.7239757237305358, 1.6768878584683387, 1.744020342392, 1.7937340109961502, 1.7599462591751491, 1.7732214524231982, 1.7623090585891015, 1.7792398502396787, 1.7351839203985422, 1.7243157246982166, 1.7864582978449044, 1.7942454887698027, 1.7374370643142174, 1.758504228730326, 1.765247224584108, 1.7754170952724047, 1.8377965024566336, 1.8072778393199633, 1.8130266231783776, 1.8102773928193905, 1.7928328598260406, 1.7824689670761822, 1.8243799377562198, 1.862152403027572, 1.7696784208436287, 1.8235285431532628, 1.8515154545437995, 1.8633617424226652, 1.8056850648810525, 1.8328782587335202, 1.8327144673804037, 1.8462062132729695, 1.8913367995293766, 1.8461314703077623, 1.8134172404573299, 1.807866098016662, 1.8652996506106905, 1.8127720746626312, 1.854172326139305, 1.8494763520703092, 1.7657156409314552, 1.8495047845921488, 1.8591123675526624, 1.8432041456250072, 1.8307948965231673, 1.8968263209826552, 1.831142145311492, 1.81938114499198, 1.7990618986217533, 1.8539278842064923, 1.8492357223180083, 1.852292171163276, 1.8512945033020396, 1.8378379084294263, 1.876790340575859, 1.8426536069561361, 1.8753686244369818, 1.881182702395365, 1.8603916319040201, 1.8212443937073142, 1.877572313899407, 1.8650853836031511, 1.8550631457800566, 1.85061320733348, 1.8591771076231778, 1.8876750756527876, 1.9127745503380955, 1.8596341192350294, 1.8656318663732456, 1.9125189289532993, 1.8475193741374571, 1.8448833865463707, 1.9057020682419739, 1.8638436891532326, 1.9336317399852105, 1.817306684803012, 1.8738041220469241, 1.955743350296158, 1.9332914025932832, 1.974853344726995])
plt.plot(range(iterations), [-0.8785136914831481, -0.0396790576220501, 0.814347934103967, 1.1729473199971314, 1.2586691598936526, 1.3293645434915322, 1.4850673953290798, 1.5201522992286738, 1.527570526432444, 1.5427607818510833, 1.569172220276501, 1.6043571047655838, 1.5708219385220274, 1.6507721600642362, 1.6185251218743, 1.6220025486159506, 1.6731251585484304, 1.689491345645017, 1.6940480118713992, 1.7343789913084038, 1.706413443888191, 1.668920807976182, 1.7792706982332942, 1.7635399737336395, 1.729653482222515, 1.7693343228691836, 1.7920756347319835, 1.7407963531403043, 1.7964875171778745, 1.7661364577067349, 1.7992312233687198, 1.7245621485071123, 1.8191918334810302, 1.780570387671594, 1.8054450609215196, 1.7841538505568422, 1.8150226729473689, 1.7717313284173573, 1.8455929488834648, 1.8275613092577239, 1.8088071328026685, 1.8725803022874328, 1.7655415501255094, 1.786172708730009, 1.8076115496091187, 1.7620039188515688, 1.8435604738814453, 1.8066209506876643, 1.854805733342562, 1.8621813841800328, 1.8232432968319239, 1.839081742943838, 1.903948499102333, 1.8566739441931839, 1.8713906549003412, 1.8431532618822, 1.8422149560612917, 1.8092056091903275, 1.825780200525646, 1.8286114373243116, 1.8415195133710962, 1.82407237170823, 1.7820535866913139, 1.787462288420878, 1.8897084091333847, 1.9031183261913678, 1.856726694285187, 1.8578942979380693, 1.8871946892132074, 1.8040486819309935, 1.8774886148211243, 1.8673572023791827, 1.8448960162110817, 1.8938716749045958, 1.881717480634932, 1.8328931990570365, 1.8243261865372626, 1.8576519917732235, 1.831405198305709, 1.8346255594864744, 1.9012661666256185, 1.8801109697545946, 1.89618430023062, 1.872663583234122, 1.8115674494986083, 1.8820616306584743, 1.8037913202293798, 1.9258889417835006, 1.9084667307279326, 1.8265617637574445, 1.8491542321615824, 1.814237518589668, 1.852278417031842, 1.8905291984166048, 1.8488435290766458, 1.8262419385365716, 1.8689319719237452, 1.849301437295508, 1.844296145980784, 1.8098737260425362])
plt.plot(range(iterations), [-0.20502256956075335, 0.42931512424152296, 0.8832640078080412, 1.0745535821707557, 1.1441852707853393, 1.064446713634427, 1.2207314475642532, 1.1843331286106136, 1.256846661408691, 1.187066949713322, 1.3199175535937122, 1.331113039957795, 1.2687519889962706, 1.3498636230381522, 1.3241062227833924, 1.1652761175820987, 1.280544539162348, 1.3248409390676799, 1.2539191102096325, 1.3264975157436847, 1.3148764894291787, 1.3504834017883909, 1.3174139725156324, 1.2473244313898733, 1.3742052902437676, 1.248532365408575, 1.379554321830083, 1.3221368715358766, 1.3953407789413554, 1.325190419524716, 1.3922221262808898, 1.4165119399799257, 1.3569924252884586, 1.3627622000589612, 1.3515945900374307, 1.3041911473595407, 1.2872186082117656, 1.334006175630738, 1.3521987620993496, 1.4087821761229213, 1.3190799929081143, 1.3338928261098424, 1.3261353595865029, 1.4128962845609419, 1.3075970207856422, 1.4005524250261185, 1.3092977364931442, 1.3970174510289655, 1.3328281342009736, 1.3696460709234368, 1.3932820034673112, 1.4257714879685754, 1.3441299327202658, 1.2880839593685243, 1.3888238808817526, 1.3114261769133397, 1.322149261842422, 1.4559248626424064, 1.318192604753659, 1.421306847984119, 1.3993924054344282, 1.3476909296498967, 1.3523059204634251, 1.3495458757439711, 1.2597734112869707, 1.3768620656696302, 1.3000305638971619, 1.3415009352103264, 1.3019165699410264, 1.3382452960813653, 1.3454988190175199, 1.3598786791514694, 1.3503623305743329, 1.4226753690180376, 1.3455103166744755, 1.4043159385991295, 1.3764844916863104, 1.3856883103142468, 1.3779215807589926, 1.3985285020268314, 1.3019573680471903, 1.3804704329998008, 1.3532441250363383, 1.3694504907999767, 1.3879818526163243, 1.4117918637949762, 1.3155066578855192, 1.324357534577061, 1.3305933447476246, 1.3938067533429686, 1.4315890796154174, 1.3260666945610862, 1.3347614906892344, 1.2993745694961236, 1.3741197608633282, 1.3533230471895623, 1.357162868539733, 1.351034231409864, 1.3155733320479517, 1.3629667474068945])
plt.plot(range(iterations), [0.7461898514806549, 0.7236718361065114, 0.6769076969952095, 0.6747626404368268, 0.734623644773269, 0.7067099336381615, 0.7451386971900129, 0.7357277794027693, 0.6292430649662271, 0.6094585363833241, 0.7244782742052202, 0.7154418951383378, 0.74592528881474, 0.6882521126910417, 0.7456896622816575, 0.7152515171806377, 0.7157687584139218, 0.6821896871366672, 0.7097392674046898, 0.6499846275960498, 0.6119801062441304, 0.7628838143178182, 0.6367967478612608, 0.6442571340757541, 0.6735309287272181, 0.6765262459005374, 0.7029081445769748, 0.6654776112093376, 0.6062404581921136, 0.7133419200703848, 0.71101403308634, 0.7478124051004436, 0.8030534487786742, 0.6902189482365901, 0.6850584443793525, 0.6560220184907245, 0.6581751747398802, 0.7234213833702019, 0.6830132280108203, 0.6552466975491192, 0.7232624592612521, 0.6466864523416317, 0.7278082670708612, 0.6950094513727819, 0.6693030834420363, 0.7593465350884702, 0.7044482750864204, 0.7221541948622706, 0.6142248757817663, 0.7808658105504451, 0.7747985676909225, 0.6940796680103617, 0.7982135536797752, 0.7170256152939859, 0.7444131661463679, 0.6505943540113355, 0.7253320351466809, 0.6601147475864534, 0.6672782556100177, 0.7191028133675449, 0.7183740703820968, 0.7489844817167672, 0.6020115519472957, 0.7174661638466358, 0.6636281072809574, 0.6971656656889366, 0.7415899662507243, 0.6511504895352496, 0.7150579383713043, 0.6521749526513868, 0.6796349065773888, 0.6866405057314922, 0.68708694640682, 0.7428928774946798, 0.8225881406576396, 0.650925753709119, 0.6897686084064764, 0.714842266531757, 0.6986645514315399, 0.7782590065829516, 0.683522049653947, 0.7961907214001528, 0.6347706992051658, 0.5633030829512763, 0.7133651215011491, 0.7938162579868185, 0.7788790905611188, 0.7641812674876203, 0.736513835960263, 0.6797973778276607, 0.7310593857933574, 0.7504876876419455, 0.7733123993123979, 0.6685111983817446, 0.7230555221968531, 0.7539967690594016, 0.7909071297463738, 0.6749244723951554, 0.7023147732150866, 0.6690690655967746])
plt.legend(['epsilon = 0', 'epsilon = 0.01', 'epsilon = 0.1', 'epsilon = 0.5', 'epsilon = 1'])
plt.savefig("Comparison.png")
'''